$(document).ready(function(){var t={apiKey:"AIzaSyBYjvjsGuAPDEfbIri0qDOeOUdAmYh4UCE",authDomain:"my-fridge-app.firebaseapp.com",databaseURL:"https://my-fridge-app.firebaseio.com",storageBucket:"my-fridge-app.appspot.com",messagingSenderId:"602672984309"};firebase.initializeApp(t);var e=firebase.database(),i={fridge:"",freezer:"",list:"",name:"",photo:""},n=firebase.auth(),o=new firebase.auth.GoogleAuthProvider,s=new firebase.auth.FacebookAuthProvider;n.onAuthStateChanged(function(t){t?($(".login-screen").hide(),i.fridge=e.ref("users/"+t.uid+"/fridge"),i.freezer=e.ref("users/"+t.uid+"/freezer"),i.list=e.ref("users/"+t.uid+"/list"),i.name=t.displayName,i.data=t,i.photo=t.photoURL,r.init(),d.init()):($(".login-screen").show().css("background","rgba(0,0,0,.9)"),$("span.login-btn").on("click",function(t){var e=$(t.target).attr("id");e="google"===e?o:s,firebase.auth().signInWithRedirect(e),firebase.auth().getRedirectResult().then(function(t){}).catch(function(t){alert(t.message)})}))});var a={getOrientation:function(t,e){var i=new FileReader;i.onload=function(t){var i=new DataView(t.target.result);if(65496!=i.getUint16(0,!1))return e(-2);for(var n=i.byteLength,o=2;o<n;){var s=i.getUint16(o,!1);if(o+=2,65505==s){if(1165519206!=i.getUint32(o+=2,!1))return e(-1);var a=18761==i.getUint16(o+=6,!1);o+=i.getUint32(o+4,a);var r=i.getUint16(o,a);o+=2;for(var d=0;d<r;d++)if(274==i.getUint16(o+12*d,a))return e(i.getUint16(o+12*d+8,a))}else{if(65280!=(65280&s))break;o+=i.getUint16(o,!1)}}return e(-1)},i.readAsArrayBuffer(t.slice(0,65536))},resetOrientation:function(t,e,i){var n=new Image;n.onload=function(){var t=n.width,o=n.height,s=544,a=document.createElement("canvas"),r=a.getContext("2d");switch(t>o?t>s&&(o*=s/t,t=s):o>s&&(t*=s/o,o=s),a.width=t,a.height=o,[5,6,7,8].indexOf(e)>-1?(a.width=o,a.height=t):(a.width=t,a.height=o),e){case 2:r.transform(-1,0,0,1,t,0);break;case 3:r.transform(-1,0,0,-1,t,o);break;case 4:r.transform(1,0,0,-1,0,o);break;case 5:r.transform(0,1,1,0,0,0);break;case 6:r.transform(0,1,-1,0,o,0);break;case 7:r.transform(0,-1,-1,0,o,t);break;case 8:r.transform(0,-1,1,0,0,t);break;default:r.transform(1,0,0,1,0,0)}r.drawImage(n,0,0,t,o),i(a.toDataURL("image/jpeg",.5))},n.src=t},itemMarkup:function(t,e,i,n,o,s){e||(e="../img/food.svg");var a='<section class="food-item" data-id="'+t+'"><section class="item-img" style="background-image: url('+e+');"></section><section class="item-desc"><span class="item-name">'+i+"</span>",r=""===n||void 0===n?"":'<span class="item-quantity">'+n+"</span>",d='<span class="added-date">Added at '+o+"</span>",c=""===s||void 0===s?"":'<span class="exp-date">Expires at '+s+"</span>",l="</section></section>";return a+r+d+c+l},todoMarkup:function(t,e,i){var n=i?'class="completed"':"",o=i?"checked":"",s='<li data-id="'+t+'"'+n+'><div class="view"><input class="toggle" type="checkbox"'+o+"><label>"+e+'</label><button class="destroy"></button></div><input class="edit" value="'+e+'"></li>';return s},allTodoComplete:function(t){var e=t.every(function(t){return t.completed===!0});return e},someTodoComplete:function(t){var e=t.some(function(t){return t.completed===!0});return e}},r={UI:{currentView:"listView",currentArea:"fridge",currentEdit:"",currentItemDetails:"",slideOpen:!1,today:new Date,takePicture:document.querySelector('input[name="i-image"]'),photo:"",touchPoint:"",swiped:[],swipeEraseMsg:function(t){var e='<div class="swipeToRemove"><h1>Remove <span>'+t+'</span> from fridge?</h1><ul class="swipe-btns"><li id="swipe-y">Yes</li><li id="swipe-n">No</li></ul></div>';return e},dateConfig:{add:{altInput:!0,altFormat:"M j, Y",dateFormat:"M j, Y"},edit:function(t){return{defaultDate:t,altInput:!0,altFormat:"M j, Y",dateFormat:"M j, Y"}}}},init:function(){$("footer .year").text(this.UI.today.getFullYear()),$('input[name="i-date"]').attr("placeholder",this.formatDate(this.UI.today)),$("#removeConfirm").hide(),this.bindEvents(),$(".user-photo img").attr("src",i.photo)},formatDate:function(t){var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],i=t.getDate(),n=t.getMonth(),o=t.getFullYear();return e[n]+" "+i+", "+o},bindEvents:function(){$("ul.nav-items").on("touch click","li",this.toggleNav.bind(this)),$(document).on("keydown",this.checkForEscape.bind(this)),$(".add-item").on("touch click",this.addItem.bind(this)),$("#add-btn").on("touch click",this.registerNew.bind(this)),$("#save-btn").on("touch click",this.updateItem.bind(this)),$("#remove-btn").on("touch click",this.showRemoveModal.bind(this)),$("li#n-btn").on("touch click",this.cancelRemove.bind(this)),$("li#y-btn").on("touch click",this.confirmRemove.bind(this)),$("#cancel-btn, #abort-btn").on("touch click",this.cancelOverlay.bind(this)),$(".todo-btn, .close-panel").on("touch click",this.openTodo.bind(this)),$("section.item-list").on("touch click",".food-item",this.editItem.bind(this)),$("section.item-list").on("touchstart",".food-item",this.touchStart.bind(this)),$("section.item-list").on("touchend",".food-item",this.touchEnd.bind(this)),$("input").on("focus",this.unhighlightFields.bind(this)),$(".logout-btn").on("touch click",this.signOut.bind(this)),this.UI.takePicture.onchange=this.takePhoto.bind(this),i.freezer.on("value",this.render.bind(this)),i.fridge.on("value",this.render.bind(this))},checkForEscape:function(t){27===t.which&&(this.UI.slideOpen?$(".new-todo").val(""):"listView"===this.UI.currentView||$('input[name="i-exp"]')[0]._flatpickr.isOpen||$('input[name="i-date"]')[0]._flatpickr.isOpen||this.setView("listView"))},signOut:function(){firebase.auth().signOut()},touchStart:function(t){this.UI.touchPoint={x:t.originalEvent.touches[0].pageX,y:t.originalEvent.touches[0].pageY}},cancelSwipe:function(t){var e=_.findWhere(this.UI.swiped,{id:t});$(e.section).css("background","#FFF"),$(e.section).html(e.content),$(e.section).attr("data-swipe",""),this.UI.swiped=_.without(this.UI.swiped,e)},cancelSwipeAll:function(){0!==this.UI.swiped.length&&(this.UI.swiped.forEach(function(t){$(t.section).css("background","#FFF"),$(t.section).html(t.content),$(t.section).attr("data-swipe","")}),this.UI.swiped=[])},swipeConfirm:function(t){var e=_.findWhere(this.UI.swiped,{id:t});i[this.UI.currentArea].child(t).remove(),this.UI.swiped=_.without(this.UI.swiped,e)},touchEnd:function(t){t.preventDefault();var e={x:t.originalEvent.changedTouches[0].pageX,y:t.originalEvent.changedTouches[0].pageY};if(this.UI.touchPoint.x===e.x&&this.UI.touchPoint.y===e.y){var i=$(t.target).closest("li").attr("id"),n=$(t.target).closest("section").attr("data-id");"swipe-y"===i?this.swipeConfirm(n):"swipe-n"===i?this.cancelSwipe(n):this.editItem(t)}else if(this.UI.touchPoint.x-e.x>100){var o=$(t.target).closest("section.food-item");$(o).attr("data-swipe")||($(o).attr("data-swipe","true"),$(o).addClass("food-item-swipe"),this.swipeToErase(o))}},swipeToErase:function(t){var e=$(t).find("span.item-name").text(),i={id:$(t).attr("data-id"),section:$(t),content:$(t).html()};this.UI.swiped.push(i),$(t).css("background","#F2AF00"),$(t).html(this.UI.swipeEraseMsg(e))},renderItemList:function(t){this.setView("loading");var e=this;i[t].once("value").then(function(t){e.render(t)})},removeItemList:function(){$("section.item-list").find("*").not("div, img").remove()},toggleNav:function(t){var e=$(t.target),i=$(e).html().toLowerCase();$(e).addClass("selected"),$("ul.nav-items li").not(e).removeClass("selected"),this.UI.currentArea!==i&&(this.removeItemList(this.UI.currentArea),this.UI.currentArea=i,$("div.add-item span").text(i),this.renderItemList(i),this.changeBodyBg())},changeBodyBg:function(){var t;switch(this.UI.currentArea){case"fridge":t='url("../img/pat.png")';break;case"freezer":t='url("../img/pat-2.png")'}$("body").css("background-image",t).fadeIn(2e3)},addItem:function(){$(".adding-item h1").text("Add an item"),$('input[name="i-date"], input[name="i-exp"]').flatpickr(this.UI.dateConfig.add),this.setView("addItem")},editItem:function(t){this.cancelSwipeAll();var e=$(t.target).closest("section.food-item");if(!$(e).attr("data-swipe")){this.setView("loading"),$(".adding-item h1").text("Edit an item");var n,o=this,s=$(t.target).closest("section.food-item").attr("data-id");i[this.UI.currentArea].child(s).on("value",function(t){n=t.val(),o.UI.currentEdit=s,o.UI.currentItemDetails=n,o.setView("editItem"),o.setEditingContents(n)})}},updateItem:function(){console.log($('input[name="i-exp"]'));var t=this.getItemInfo("existing");this.requiredFieldsComplete(t.img,t.name,t.added)?(i[this.UI.currentArea].child(this.UI.currentEdit).update(t),this.setView("listView"),this.resetInputFields()):$(".msg").show()},showRemoveModal:function(t){$(".remove-msg span").text(this.UI.currentArea),$("#removeConfirm").fadeIn(200)},confirmRemove:function(){i[this.UI.currentArea].child(this.UI.currentEdit).remove(),$("#removeConfirm").hide(),this.setView("listView")},cancelRemove:function(){$("#removeConfirm").fadeOut(200)},setEditingContents:function(t){var e=t.img||"../img/food.svg";$(".editing-fields div.photo").css("background-image",'url("'+e+'")').css("background-size","cover"),$('input[name="i-name"]').val(t.name),$('input[name="i-quantity"]').val(t.qty),$('input[name="i-date"]').flatpickr(this.UI.dateConfig.edit(t.added)),$('input[name="i-exp"]').flatpickr(this.UI.dateConfig.edit(t.exp))},render:function(t){var e=t.val(),i=_.keys(e),n=_.map(i,function(t){var i=e[t];return{id:t,name:i.name,img:i.img,qty:i.qty,added:i.added,exp:i.exp}}),o="";n.forEach(function(t){o+=a.itemMarkup(t.id,t.img,t.name,t.qty,t.added,t.exp)}),$("section.item-list").not("div, img").html(o),this.setView("listView")},takePhoto:function(t){var e,i=this,n=t.target.files,o=($("label.photo-file img"),$("div.photo"));n&&n.length>0&&(this.UI.photo=n[0]),e=window.URL.createObjectURL(this.UI.photo),a.getOrientation(this.UI.photo,function(t){a.resetOrientation(e,t,function(t){$(o).css("background-image",'url("'+t+'")').css("background-size","cover"),i.UI.photo=t})})},setView:function(t){if(!this.UI.slideOpen)switch(t){case"loading":$("section.loading-anim").show(),$("section.adding-item").hide();break;case"addItem":$("section.loading-anim").hide(),$("section.adding-item").show(),$(".add-btn-list").show(),$(".edit-btn-list").hide(),$(".overlay").css("opacity","1").fadeIn("200"),this.UI.currentView="addItem",$("body").addClass("noscroll");break;case"editItem":$("section.loading-anim").hide(),$("section.adding-item").show(),$(".add-btn-list").hide(),$(".edit-btn-list").show(),$(".overlay").css("opacity","1").fadeIn("200"),this.UI.currentView="editItem",$("body").addClass("noscroll");break;case"listView":$("section.loading-anim").hide(),$(".overlay").fadeOut("200"),this.UI.currentView="listView",this.resetInputFields(),$("body").removeClass("noscroll")}},getItemInfo:function(t){var e;e="new"===t?this.UI.photo||"../img/food.svg":this.UI.photo||this.UI.currentItemDetails.img;var i=$('input[name="i-name"]').val(),n=$('input[name="i-quantity"]').val(),o=$('input[name="i-date"]').val(),s=$('input[name="i-exp"]').val();return{name:i,img:e,qty:n,added:o,exp:s}},registerNew:function(){var t=this.getItemInfo("new");if(this.requiredFieldsComplete(t.img,t.name,t.added,t.exp)){var e=a.itemMarkup(t.img,t.name,t.qty,t.added,t.exp);$("section.item-list").append(e),i[this.UI.currentArea].push(t),this.setView("listView"),this.resetInputFields()}else $(".msg").show()},requiredFieldsComplete:function(t,e,i,n){return""===e&&"../img/food.svg"===t?(this.highlightFields("name"),!1):""!==i||""!==n||(this.highlightFields("date"),!1)},highlightFields:function(t){switch(t){case"name":$("#i-name, .photo").css("box-shadow","0px 0px 10px 5px #F2AF00"),$("span.msg").html("Please provide <i>a photo</i> or <i>a name</i>!");break;case"date":$("#i-date, #i-exp").closest("div").css("box-shadow","0px 0px 10px 5px #F2AF00"),$("span.msg").html("Please enter <i>added date</i> or <i>expiration date</i>!")}},unhighlightFields:function(){$("#i-name, .photo").css("box-shadow","none"),$("#i-date, #i-exp").closest("div").css("box-shadow","none"),$(".msg").hide()},cancelOverlay:function(){this.setView("listView"),this.resetInputFields()},resetInputFields:function(){$("div.photo").css("background-image",'url("../img/add-photo.svg")').css("background-size","inherit"),$('input[name="i-name"]').val(""),$('input[name="i-quantity"]').val(""),$('input[name="i-date"]').val(""),$('input[name="i-exp"]').val(""),this.unhighlightFields(),this.UI.photo=""},showPanel:function(){var t=this;$(".todo-panel").stop().animate({left:"0vw"},300).promise().done(function(){t.UI.slideOpen=!0})},hidePanel:function(){var t=this;$(".todo-panel").stop().animate({left:"-92vw"},300).promise().done(function(){t.UI.slideOpen=!1})},openTodo:function(){this.UI.slideOpen?(this.hidePanel(),$("body").removeClass("noscroll")):(this.showPanel(),$("body").addClass("noscroll"))}},d={init:function(){this.bindEvents()},bindEvents:function(){$("input.new-todo").on("keydown",this.checkForEnter.bind(this)),$(".add-todo-btn").on("touch click",this.checkVal.bind(this)),$(".todo-list").on("touch click","li .view .toggle",this.toggleTodo.bind(this)),$(".todo-list").on("touch click","li .view .destroy",this.removeTodo.bind(this)),$(".main-list").on("touch click",".toggle-all",this.toggleAll.bind(this)),$("footer.shoplist .clear-completed").on("touch click",this.clearCompleted.bind(this)),i.list.on("value",this.render.bind(this))},render:function(t){var e=t.val(),i=_.keys(e),n=_.map(i,function(t){var i=e[t];return{id:t,content:i.content,completed:i.completed}}),o="";n.forEach(function(t){var e=a.todoMarkup(t.id,t.content,t.completed);o+=e}),$(".todo-list").html(o),this.checkIfEmpty(n.length),this.displayNumberOfItems(n)},checkIfEmpty:function(t){0===t?($(".main-list").hide(),$("footer.shoplist").hide()):($(".main-list").show(),$("footer.shoplist").show())},checkForEnter:function(t){13===t.which&&this.checkVal()},checkVal:function(){var t=$(".new-todo").val().trim();$(".new-todo").val(""),""!==t&&this.createToDo(t)},createToDo:function(t){var e={completed:!1,content:t};i.list.push(e)},toggleTodo:function(t){var e=$(t.target).parents("li").attr("data-id");i.list.child(e).once("value").then(function(t){var n=t.val(),o=!n.completed;i.list.child(e).update({completed:o})}),$(t.target).parents("li").toggleClass("completed")},toggleAll:function(t){var e=this;i.list.once("value").then(function(t){var i=t.val(),n=_.keys(i),o=_.map(n,function(t){var e=i[t];return{id:t,content:e.content,completed:e.completed}}),s=!a.allTodoComplete(o);e.toggleVal(o,s)})},toggleVal:function(t,e){var n=e;switch(t.forEach(function(t){i.list.child(t.id).update({completed:n})}),n){case!0:$(".todo-list li").addClass("completed"),$(".todo-list li .view input:checkbox").prop("checked",!0),$("footer.shoplist .clear-completed").show();break;case!1:$(".todo-list li").removeClass("completed"),$(".todo-list li .view input:checkbox").prop("checked",!1),$("footer.shoplist .clear-completed").hide()}},clearCompleted:function(){i.list.once("value").then(function(t){var e=t.val(),n=_.keys(e),o=_.map(n,function(t){var i=e[t];return{id:t,content:i.content,completed:i.completed}});o.forEach(function(t){var e=t.id;t.completed&&i.list.child(e).remove()})})},removeTodo:function(t){var e=$(t.target).parents("li").attr("data-id");i.list.child(e).remove(),$(t.target).parents("li").remove()},getTotalNumber:function(t){var e=0;return t.forEach(function(t){t.completed===!1&&e++}),e},displayNumberOfItems:function(t){var e=this.getTotalNumber(t),i=$("footer.shoplist .clear-completed");$(".list-count").html("<strong>"+e+"</strong> item"+(1===e?" left":"s left")),a.someTodoComplete(t)?$(i).show():$(i).hide(),$(".toggle-all").prop("checked",!!a.allTodoComplete(t))}}});