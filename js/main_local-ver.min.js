$(document).ready(function(){var e={getOrientation:function(e,t){var i=new FileReader;i.onload=function(e){var i=new DataView(e.target.result);if(65496!=i.getUint16(0,!1))return t(-2);for(var n=i.byteLength,a=2;a<n;){var s=i.getUint16(a,!1);if(a+=2,65505==s){if(1165519206!=i.getUint32(a+=2,!1))return t(-1);var r=18761==i.getUint16(a+=6,!1);a+=i.getUint32(a+4,r);var o=i.getUint16(a,r);a+=2;for(var c=0;c<o;c++)if(274==i.getUint16(a+12*c,r))return t(i.getUint16(a+12*c+8,r))}else{if(65280!=(65280&s))break;a+=i.getUint16(a,!1)}}return t(-1)},i.readAsArrayBuffer(e.slice(0,65536))},resetOrientation:function(e,t,i){var n=new Image;n.onload=function(){var e=n.width,a=n.height,s=544,r=document.createElement("canvas"),o=r.getContext("2d");switch(e>a?e>s&&(a*=s/e,e=s):a>s&&(e*=s/a,a=s),r.width=e,r.height=a,[5,6,7,8].indexOf(t)>-1?(r.width=a,r.height=e):(r.width=e,r.height=a),t){case 2:o.transform(-1,0,0,1,e,0);break;case 3:o.transform(-1,0,0,-1,e,a);break;case 4:o.transform(1,0,0,-1,0,a);break;case 5:o.transform(0,1,1,0,0,0);break;case 6:o.transform(0,1,-1,0,a,0);break;case 7:o.transform(0,-1,-1,0,a,e);break;case 8:o.transform(0,-1,1,0,0,e);break;default:o.transform(1,0,0,1,0,0)}o.drawImage(n,0,0,e,a),i(r.toDataURL("image/jpeg",.5))},n.src=e},itemMarkup:function(e,t,i,n,a){e||(e="../img/food.svg");var s='<section class="food-item"><section class="item-img" style="background-image: url('+e+');"></section><section class="item-desc"><span class="item-name">'+t+"</span>",r=""===i||void 0===i?"":'<span class="item-quantity">'+i+"</span>",o='<span class="added-date">Added at '+n+"</span>",c=""===a||void 0===a?"":'<span class="exp-date">Expires at '+a+"</span>",d="</section></section>";return s+r+o+c+d}},t={Items:{fridge:[],freezer:[]},UI:{currentView:"listView",currentArea:"fridge",slideOpen:!1,today:new Date,takePicture:document.querySelector('input[name="i-image"]'),photo:"",calendar:""},init:function(){$(".overlay").hide(),this.bindEvents(),this.render()},bindEvents:function(){$("ul.nav-items").on("touch click","li",this.toggleNav.bind(this)),$(".add-item").on("touch click",this.addItem.bind(this)),$("#add-btn").on("touch click",this.registerNew.bind(this)),$(".todo-btn").on("touch click",this.openTodo.bind(this)),$("#cancel-btn").on("touch click",this.cancelOverlay.bind(this)),this.UI.calendar=new flatpickr('input[name="i-date"], input[name="i-exp"]',{altInput:!0,altFormat:"M j, Y",dateFormat:"M j, Y"}),this.UI.takePicture.onchange=this.takePhoto.bind(this),userFridge.on("value",this.render.bind(this))},renderItemList:function(t){this.Items[t].forEach(function(t){var i=e.itemMarkup(t.img,t.name,t.qty,t.added,t.exp);$("section.item-list").append(i)})},removeItemList:function(){$("section.item-list").find("*").not("div, img").remove()},toggleNav:function(e){var t=$(e.target),i=$(t).html().toLowerCase();if($(t).addClass("selected"),$("ul.nav-items li").not(t).removeClass("selected"),this.UI.currentArea!==i)switch(this.removeItemList(this.UI.currentArea),this.UI.currentArea=i,this.renderItemList(i),this.UI.currentArea){case"fridge":$("body").css("background-image",'url("../img/pat.png")').fadeIn(3e3);break;case"freezer":$("body").css("background-image",'url("../img/pat-2.png")').fadeIn(3e3)}},addItem:function(){this.changeView("addItem")},checkEscape:function(e){27===e.which&&"listView"!==this.UI.currentView&&this.changeView("listView")},render:function(t){var i=t.val(),n=_.keys(i),a=_.map(n,function(e){var t=i[e];return{id:e,name:t.name,img:t.img,qty:t.qty,added:t.added,exp:t.exp}}),s="";a.forEach(function(t){s+=e.itemMarkup(t.img,t.name,t.qty,t.added,t.exp)}),$("section.item-list").not("div, img").html(s)},takePhoto:function(t){var i,n=this,a=t.target.files,s=($("label.photo-file img"),$("div.photo"));a&&a.length>0&&(this.UI.photo=a[0]),i=window.URL.createObjectURL(this.UI.photo),e.getOrientation(this.UI.photo,function(t){e.resetOrientation(i,t,function(e){$(s).css("background-image",'url("'+e+'")').css("background-size","cover"),n.UI.photo=e})})},changeView:function(e){switch(this.UI.slideOpen&&this.hidePanel(),e){case"addItem":$(".overlay").css("opacity","1").fadeIn("400"),this.UI.currentView="addItem",$("body").addClass("noscroll");break;case"editItem":$(".overlay").css("opacity","1").fadeIn("400"),this.UI.currentView="editItem",$("body").addClass("noscroll");break;case"listView":$(".overlay").fadeOut("400"),this.UI.currentView="listView",this.resetInputFields(),$("body").removeClass("noscroll")}},registerNew:function(){var t=this.UI.photo||"../img/food.svg",i=$('input[name="i-name"]').val(),n=$('input[name="i-quantity"]').val(),a=$('input[name="i-date"]').val(),s=$('input[name="i-exp"]').val();if(this.requiredFieldsComplete(i,n,a)){var r=e.itemMarkup(t,i,n,a,s);$("section.item-list").append(r);var o={name:i,img:t,qty:n,added:a,exp:s};switch(this.UI.currentArea){case"fridge":userFridge.push(o);break;case"freezer":userFreezer.push(o)}this.changeView("listView"),this.resetInputFields()}else $(".msg").show()},requiredFieldsComplete:function(e,t,i){return""!==e&&""!==i},cancelOverlay:function(){this.changeView("listView"),this.resetInputFields()},resetInputFields:function(){$("div.photo").css("background-image",'url("../img/add-photo.svg")').css("background-size","inherit"),$('input[name="i-name"]').val(""),$('input[name="i-quantity"]').val(""),$('input[name="i-date"]').val(""),$('input[name="i-exp"]').val(""),this.UI.calendar[0].clear(),this.UI.calendar[1].clear(),$(".msg").hide(),this.UI.photo=""},showPanel:function(){$(".todo-panel").animate({left:"+=92vw"},300,function(){}),this.UI.slideOpen=!0},hidePanel:function(){$(".todo-panel").animate({left:"-=92vw"},300,function(){}),this.UI.slideOpen=!1},openTodo:function(){this.UI.slideOpen?(this.hidePanel(),$("body").removeClass("noscroll")):(this.showPanel(),$("body").addClass("noscroll"))}},i={init:function(){}};t.init(),i.init()});